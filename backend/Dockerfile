FROM node:21

WORKDIR /app

COPY package*.json ./
COPY prisma ./prisma/

RUN npm install

ARG APP_ENV
ENV APP_ENV=$APP_ENV

ARG APP_PORT
ENV APP_PORT=$APP_PORT

ARG BASIC_AUTH_SECRET
ENV BASIC_AUTH_SECRET=$BASIC_AUTH_SECRET

ARG AUTH_TOKEN
ENV AUTH_TOKEN=$AUTH_TOKEN

ARG JWT_SECRET
ENV JWT_SECRET=$JWT_SECRET

ARG APP_NAME
ENV APP_NAME=$APP_NAME

ARG STEAM_API_KEY
ENV STEAM_API_KEY=$STEAM_API_KEY

ARG DATABASE_URL
ENV DATABASE_URL=$DATABASE_URL

RUN npx prisma generate

EXPOSE 3000

COPY . .

CMD ["npm", "run", "dev"]